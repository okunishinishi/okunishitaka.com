/**
 * Bud file for entity test.
 */

"use strict";

var u = require('apeman-util'),
    fs = u.core.fs,
    filtering = u.filtering,
    string = u.string,
    mapping = u.mapping,
    reducing = u.reducing,
    path = u.core.path;

var basedir = path.resolve(__dirname, '../../../..'),
    srcDir = path.resolve(basedir, 'public/javascripts/ok/components'),
    destDir = __dirname;

function componentTestBud(srcDir, destDir) {
    return fs.readdirSync(srcDir)
        .filter(filtering.patternRejectFilter(/^_/))
        .filter(filtering.patternAcceptFilter(/\.js$/))
        .map(mapping.pathResolveMap(srcDir))
        .map(function (src) {
            var name = path.basename(src, path.extname(src)).replace(/\-entity$/, '');
            return {
                force: false,
                mode: '644',
                path: path.resolve(destDir, name + '-test.js'),
                data: {
                    prefix: 'ok',
                    name: string.camelString(name),
                    Name: string.pascalString(name)
                }
            }
        });
}


module.exports = [
    componentTestBud(path.resolve(srcDir), destDir)
].reduce(reducing.concatReduce(), []);
